{"version":3,"sources":["file:///Users/xiejiapei/Documents/Car/assets/script/logic/gameLogic.ts"],"names":["_decorator","playerData","clientEvent","configuration","constant","resourceUtil","flyReward","uiManager","ccclass","gameLogic","addGold","gold","instance","updatePlayerInfo","dispatchEvent","useCar","carId","buyCar","isVibrateOpen","getGlobalData","undefined","getOpenRewardType","funStr","callback","index","OPEN_REWARD_TYPE","NULL","checkIsByVideoAds","updateRewardIcon","spIcon","imgAd","imgShare","err","type","AD","node","active","spriteFrame","SHARE","finishBuyTask","value","isAdd","openReward","afterLogin","isNewBee","checkSignIn","playerInfo","level","updateSignInCurrentDay","getSignInReceivedInfo","isTodayReceived","pushToPopupSeq","showFlyReward","rewardType","createUI","reward","getComponent","setEndListener"],"mappings":"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","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\n\nimport { _decorator, Sprite, SpriteFrame, Node } from \"cc\";\nimport { playerData } from \"../framework/playerData\";\nimport { clientEvent } from \"../framework/clientEvent\";\nimport { configuration } from \"../framework/configuration\";\nimport { constant } from \"../framework/constant\";\nimport { resourceUtil } from \"../framework/resourceUtil\";\nimport { flyReward } from \"../ui/main/flyReward\";\nimport { uiManager } from \"../framework/uiManager\";\nconst { ccclass } = _decorator;\n\n@ccclass(\"gameLogic\")\nexport class gameLogic {\n    /* class member could be defined like this */\n    // dummy = '';\n\n    public static imgAd: SpriteFrame | null = null;\n    public static imgShare: SpriteFrame | null = null;\n\n    public static addGold (gold: number) {\n        playerData.instance.updatePlayerInfo('gold', gold);\n\n        clientEvent.dispatchEvent('updateGold');\n    }\n\n    public static useCar (carId: number) {\n        playerData.instance.useCar(carId);\n\n        clientEvent.dispatchEvent('updateCar');\n    }\n\n    public static buyCar (carId: number) {\n        playerData.instance.buyCar(carId);\n        clientEvent.dispatchEvent('buyCar');\n    }\n\n    public static isVibrateOpen () {\n        let isVibrateOpen = configuration.instance.getGlobalData('vibrate');\n        if (isVibrateOpen === undefined || isVibrateOpen === null) {\n            isVibrateOpen = true; //默认是打开的状态\n        }\n\n        return isVibrateOpen;\n    }\n\n    public static getOpenRewardType (funStr: string, callback: Function, index?: number) {\n        callback(null, constant.OPEN_REWARD_TYPE.NULL);\n    }\n\n    public static checkIsByVideoAds () {\n        return false;\n    }\n\n    /**\n     * 根据功能设置图标对应展示\n     *\n     * @static\n     * @param {string} funStr\n     * @param {Sprite} spIcon\n     * @param {Function} [callback]\n     * @param {SpriteFrame} [imgAd]\n     * @param {SpriteFrame} [imgShare]\n     * @memberof gameLogic\n     */\n    public static updateRewardIcon (funStr: string, spIcon: Sprite, callback?: Function, imgAd?: SpriteFrame, imgShare?: SpriteFrame) {\n        this.getOpenRewardType(funStr, (err: Error | null, type: number)=>{\n            switch (type) {\n                case constant.OPEN_REWARD_TYPE.AD:\n                    spIcon.node.active = true;\n                    if (imgAd) {\n                        spIcon.spriteFrame = imgAd;\n                    } else {\n                        spIcon.spriteFrame = this.imgAd;\n                    }\n                    break;\n                case constant.OPEN_REWARD_TYPE.SHARE:\n                    spIcon.node.active = true;\n                    if (imgShare) {\n                        spIcon.spriteFrame = imgShare;\n                    } else {\n                        spIcon.spriteFrame = this.imgShare;\n                    }\n                    break;\n                case constant.OPEN_REWARD_TYPE.NULL:\n                    spIcon.node.active = false;\n                    break;\n            }\n\n            if (callback) {\n                callback(err, type);\n            }\n        })\n    }\n\n    public static finishBuyTask (type: number, value: number, isAdd ?: boolean) {\n        playerData.instance.finishBuyTask(type, value, isAdd);\n        clientEvent.dispatchEvent('updateBuyTask');\n    }\n\n    public static openReward (funStr: string, callback: (...args: any[]) => void) {\n        callback && callback(null);\n    }\n\n    /**\n     * 登陆成功后会回调该方法,类似于一个声明周期或者状态\n     */\n    public static afterLogin () {\n        if (!playerData.instance.isNewBee) {\n            this.checkSignIn();\n        }\n    }\n\n    /**\n     * 如果今天还未签到则弹出\n     */\n    public static checkSignIn () {\n        if (playerData.instance.playerInfo.level === 1) {\n            //第一关未通关则不跳签到界面\n            return;\n        }\n        playerData.instance.updateSignInCurrentDay();\n        if (!playerData.instance.getSignInReceivedInfo().isTodayReceived) {\n            uiManager.instance.pushToPopupSeq('signIn/signIn', 'signIn', {});\n        }\n    }\n\n    public static showFlyReward(rewardType?: number, callback?: Function) {\n        resourceUtil.createUI('common/flyReward', (err, node)=>{\n            if (err) {\n                if (callback) {\n                    callback();\n                }\n                return;\n            }\n\n            let reward = node!.getComponent(flyReward)!;\n            // reward.setInfo(rewardType === constant.REWARD_TYPE.GOLD);\n            reward.setEndListener(callback);\n        });\n    }\n}\n"]}