{"version":3,"sources":["file:///Users/xiejiapei/NewProject_1/assets/script/ui/common/showReward.ts"],"names":["_decorator","Component","SpriteFrame","Sprite","Label","Node","Vec3","Animation","uiManager","resourceUtil","playerData","constant","localConfig","gameLogic","clientEvent","poolManager","i18n","ccclass","property","showReward","isDouble","callback","isLast","rewardType","amount","itemInfo","_isHadCar","currentCar","carDegree","rotateSpeed","start","show","title","tips","txtImmediateBtn","ndBtnDouble","active","ndBtnNormal","ndBtnImmediately","lbTitle","string","lbRewardValue","REWARD_TYPE","CAR","String","lbTips","node","showRewardPage","aniReward","play","once","EventType","FINISHED","lbImmediateBtn","t","instance","putNode","DIAMOND","GOLD","spIcon","spriteFrame","sfGold","targetCar","queryByID","ID","carModel","model","getUICar","err","prefab","console","error","getNode","ndCarParent","onBtnNormalClick","addReward","onBtnDoubleClick","openReward","SHARE_FUNCTION","SIGNIN","onBtnImmediatelyClick","updatePlayerInfo","showFlyReward","dispatchEvent","buyCar","hideDialog","update","deltaTime","eulerAngles"],"mappings":"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","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\n\nimport { _decorator, Component, SpriteFrame, Sprite, Label, Node, Vec3, Animation } from \"cc\";\nimport { uiManager } from '../../framework/uiManager';\nimport { resourceUtil } from '../../framework/resourceUtil';\nimport { playerData } from '../../framework/playerData';\nimport { constant } from '../../framework/constant';\nimport { localConfig } from '../../framework/localConfig';\nimport { gameLogic } from '../../logic/gameLogic';\nimport { clientEvent } from '../../framework/clientEvent';\nimport { poolManager } from \"../../framework/poolManager\";\nimport { i18n } from \"../../i18nMaster/runtime-scripts/LanguageData\";\n\nconst { ccclass, property } = _decorator;\n\n@ccclass(\"showReward\")\nexport class showReward extends Component {\n\n    //金币图标\n    @property(SpriteFrame)\n    sfGold: SpriteFrame = null!;\n\n    //奖励图标\n    @property(Sprite)\n    spIcon: Sprite = null!;\n\n    //奖励数量\n    @property(Label)\n    lbRewardValue: Label = null!;\n\n    //文字提示\n    @property(Label)\n    lbTips: Label = null!;\n\n    //标题\n    @property(Label)\n    lbTitle: Label = null!;\n\n    @property(Label)\n    lbImmediateBtn: Label = null!;\n\n    @property(Node)\n    ndCarParent: Node = null!;\n\n    //双倍领取按钮\n    @property(Node)\n    ndBtnDouble: Node = null!;\n\n    //普通领取按钮\n    @property(Node)\n    ndBtnNormal: Node = null!;\n\n    //立即领取按钮\n    @property(Node)\n    ndBtnImmediately: Node = null!;\n\n    @property(Animation)\n    aniReward: Animation = null!;\n\n    isDouble = false;\n    callback: Function | null = null;\n    isLast = false;\n    rewardType = 0;\n    amount = 0;\n    itemInfo: any;\n    _isHadCar = false;\n    currentCar: Node | null = null;\n    carDegree: number = 0;\n    rotateSpeed: number = 30;\n\n    start() {\n        // Your initialization goes here.\n    }\n\n    /**\n     *\n     *\n     * @param {*} itemInfo\n     * @param {boolean} isDouble 是“双倍领取、普通领取”组合或者单独一个“立即领取”\n     * @param {string} title\n     * @param {Function} callback\n     * @param {string} [tips]\n     * @memberof showReward\n     */\n    show(itemInfo: any, isDouble: boolean, title: string, callback: Function, tips?: string, txtImmediateBtn?: string) {\n        this.itemInfo = itemInfo;\n        this.rewardType = itemInfo.rewardType;\n        this.amount = itemInfo.amount;\n\n        this.ndBtnDouble.active = isDouble;\n        this.ndBtnNormal.active = isDouble;\n        this.ndBtnImmediately.active = !isDouble;\n\n        this.lbTitle.string = title;\n        this.lbRewardValue.string = itemInfo.rewardType === constant.REWARD_TYPE.CAR ? '' : String(this.amount);\n        this.callback = callback;\n\n        if (tips) {\n            this.lbTips.node.active = true;\n            this.lbTips.string = tips;\n        } else {\n            this.lbTips.node.active = false;\n        }\n\n        this.showRewardPage();\n\n        this.aniReward.play('rewardShow');\n        this.aniReward.once(Animation.EventType.FINISHED, ()=>{\n            this.aniReward.play('rewardIdle');\n        }, this);\n\n        if (txtImmediateBtn) {\n            this.lbImmediateBtn.string = txtImmediateBtn;\n        } else {\n            this.lbImmediateBtn.string = i18n.t('balance.receiveImmediately');\n        }\n    }\n\n    /**\n     * 设置奖励界面图标\n     */\n    showRewardPage() {\n        if (this.currentCar) {\n            poolManager.instance.putNode(this.currentCar);\n            this.currentCar = null;\n        }\n\n        switch (this.rewardType) {\n            case constant.REWARD_TYPE.DIAMOND:\n                break;\n            case constant.REWARD_TYPE.GOLD:\n                this.spIcon.spriteFrame = this.sfGold;\n                this.spIcon.node.active = true;\n                break;\n            case constant.REWARD_TYPE.CAR:\n                this.spIcon.node.active = false;\n\n                let targetCar = localConfig.instance.queryByID('car', this.itemInfo.ID);\n                let carModel = targetCar.model;\n                resourceUtil.getUICar(carModel, (err, prefab)=>{\n                    if (err) {\n                        console.error(err);\n                        return;\n                    }\n\n                    this.currentCar = poolManager.instance.getNode(prefab, this.ndCarParent);\n                    this.carDegree = 0;\n                })\n                // resourceUtil.setCarIcon(carModel, this.spIcon, false, ()=>{});\n                break;\n        }\n    }\n\n    onBtnNormalClick() {\n        this.addReward();\n    }\n\n    onBtnDoubleClick() {\n        gameLogic.openReward(constant.SHARE_FUNCTION.SIGNIN, (err)=>{\n            if (!err) {\n                this.amount *= 2;\n                this.addReward();\n            }\n        })\n    }\n\n    onBtnImmediatelyClick () {\n        this.addReward();\n    }\n\n    addReward() {\n        switch (this.rewardType) {\n            case constant.REWARD_TYPE.DIAMOND:\n                break;\n            case constant.REWARD_TYPE.GOLD:\n                // gameLogic.addGold(this.amount);\n                playerData.instance.updatePlayerInfo('gold', this.amount);\n                gameLogic.showFlyReward(constant.REWARD_TYPE.GOLD, ()=>{\n                    clientEvent.dispatchEvent('updateGold');\n                });\n                break;\n            case constant.REWARD_TYPE.CAR:\n                gameLogic.buyCar(this.itemInfo.ID);\n                break;\n        }\n\n        uiManager.instance.hideDialog('common/showReward');\n        this.callback &&  this.callback();\n    }\n\n    update (deltaTime: number) {\n         //旋转展示车辆\n         if (this.currentCar) {\n            this.carDegree -= deltaTime * this.rotateSpeed;\n\n            if (this.carDegree <= -360) {\n                this.carDegree += 360;\n            }\n\n            this.currentCar.eulerAngles = new Vec3(0, this.carDegree, 0);\n        }\n    }\n}\n"]}