{"version":3,"sources":["file:///Users/xiejiapei/NewProject_1/assets/script/i18nMaster/runtime-scripts/LocalizedLabel.ts"],"names":["_decorator","Component","Label","log","error","EDITOR","i18n","ccclass","property","LocalizedLabel","_debouncedUpdateLabel","label","dataID","val","_dataID","updateLabel","onLoad","debounce","inst","init","t","fetchRender","getComponent","localizedString","string","func","wait","immediate","timeout","args","arguments","later","apply","bind","callNow","clearTimeout","setTimeout","editor","executeInEditMode","menu"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, view, Label, CCString, log, error} from \"cc\";\nimport { EDITOR } from \"cc/env\";\nimport { i18n } from './LanguageData';\n\nconst { ccclass, property } = _decorator;\n@ccclass(\"LocalizedLabel\")\nexport default class LocalizedLabel extends Component {\n\n    _debouncedUpdateLabel: any = null;\n    label: Label | null = null;\n\n    static editor = {\n        executeInEditMode: true,\n        menu: 'i18n/LocalizedLabel'\n    }\n\n    @property\n    _dataID = \"\";\n\n    @property\n    set dataID (val: string) {\n        if (this._dataID !== val) {\n            this._dataID = val;\n\n            if (EDITOR) {\n                this._debouncedUpdateLabel && this._debouncedUpdateLabel();\n            } else {\n                this.updateLabel();\n            }\n        }\n    }\n\n    get dataID() {\n        return this._dataID;\n    }\n\n    onLoad () {\n        if(EDITOR) {\n            this._debouncedUpdateLabel = this.debounce(this.updateLabel, 200);\n        }\n        if (!i18n.inst) {\n            i18n.init();\n        }\n        log('dataID: ' + this.dataID + ' value: ' + i18n.t(this.dataID));\n        this.fetchRender();\n    }\n\n    fetchRender () {\n        let label = this.getComponent(Label);\n        if (label) {\n\n            this.label = label;\n\n            this.updateLabel();\n            return;\n        }\n    }\n\n    updateLabel () {\n        if (!this.label) {\n            error('Failed to update localized label, label component is invalid!');\n            return;\n        }\n        let localizedString = i18n.t(this.dataID, {});\n        if (localizedString) {\n            this.label.string = i18n.t(this.dataID, {});\n        }\n    }\n\n    debounce(func: Function, wait: number, immediate ?: number) {\n        let timeout = -1;\n        return (() => {\n            const args = arguments;\n            const later = (() => {\n                timeout = -1;\n                if (!immediate) func.apply(this, args);\n            }).bind(this);\n            const callNow = immediate && !timeout;\n            clearTimeout(timeout);\n            timeout = setTimeout(later, wait);\n            if (callNow) func.apply(this, args);\n        }).bind(this);\n    }\n}\n"]}