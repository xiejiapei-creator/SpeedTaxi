{"version":3,"sources":["file:///Users/xiejiapei/SpeedTaxi/assets/script/fight/follow.ts"],"names":["_decorator","Component","Vec3","Node","ccclass","property","follow","type","constructor","moveSpeed","isPlayingStart","start","showStart","lateUpdate","deltaTime","followTarget","posOrigin","node","worldPosition","offset","isFollowRotation","transformQuat","rotation","posTarget","x","y","z","setWorldPosition","lookAt","angle","eulerAngles","dis","subtract","length","lerp"],"mappings":"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","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\n\nimport { _decorator, Component, Vec3, Quat, Node } from \"cc\";\nconst { ccclass, property } = _decorator;\n\n@ccclass(\"follow\")\nexport class follow extends Component {\n    // Property.\n    // yourProperty = \"some what\";\n\n    // Add `property` decorator if your want the property to be serializable.\n    // @property\n    // yourSerializableProperty = \"some what\";\n    @property({type: Node})\n    public followTarget: Node | null = null;\n\n    @property\n    public isFollowRotation = true;\n\n    @property\n    public offset = new Vec3();\n    public moveSpeed = 3;\n\n    isPlayingStart = false;\n\n    constructor() {\n        super();\n    }\n\n    public start() {\n        // Your initialization goes here.\n        // this.showStart();\n    }\n\n    public showStart () {\n        //TODO 原先有个展示动画，现直接修改为玩家下\n        // this.isPlayingStart = true;\n        // this.scheduleOnce(()=>{\n        //     this.isPlayingStart = false;\n        // }, 1.5);\n    }\n\n    public lateUpdate(deltaTime: number) {\n        if (!this.followTarget) {\n            return;\n        }\n\n        let posOrigin = this.node.worldPosition;\n\n        if (!this.isPlayingStart) {\n            let offset = this.offset;\n            if (this.isFollowRotation) {\n                offset = Vec3.transformQuat(new Vec3(), this.offset, this.followTarget.rotation);\n            }\n            let posTarget = new Vec3(this.followTarget.worldPosition.x + offset.x, this.followTarget.worldPosition.y + offset.y, this.followTarget.worldPosition.z + offset.z);\n\n            // let dis = Vec3.subtract(new Vec3(), posOrigin, posTarget).length();\n\n            this.node.setWorldPosition(posTarget);\n            this.node.lookAt(this.followTarget.worldPosition, new Vec3(0, 1, 0));\n\n            if (this.isFollowRotation) {\n                let angle = new Vec3( this.node.eulerAngles );\n                angle.y = this.followTarget.eulerAngles.y;\n                this.node.eulerAngles = angle;\n            }\n\n        } else {\n            let posTarget = new Vec3(this.followTarget.worldPosition.x + this.offset.x, this.followTarget.worldPosition.y + this.offset.y, this.followTarget.worldPosition.z + this.offset.z);\n\n            let dis = Vec3.subtract(new Vec3(), posOrigin, posTarget).length();\n            if (dis > 0.001) {\n                Vec3.lerp(posTarget, posOrigin, posTarget, this.moveSpeed * deltaTime);\n            }\n\n            this.node.setWorldPosition(posTarget);\n            this.node.lookAt(this.followTarget.worldPosition, new Vec3(0, 1, 0));\n        }\n\n    }\n}\n"]}