{"version":3,"sources":["file:///Users/xiejiapei/Documents/Car/assets/script/fight/effectManager.ts"],"names":["_decorator","Component","Prefab","carManager","clientEvent","poolManager","audioManager","constant","ccclass","property","effectManager","type","currentNode","start","onEnable","on","onBrakingStart","onBrakingEnd","onDisable","off","instance","getNode","pfTailLine","node","setWorldPosition","mainCar","worldPosition","eulerAngles","playSound","AUDIO_SOUND","STOP","scheduleOnce","isValid","putNode","update","deltaTime","reset","clearPool","name","arr","children","slice","idx","length","destroy"],"mappings":"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","sourcesContent":["import { _decorator, Component, Prefab, Node } from \"cc\";\nimport { carManager } from \"./carManager\";\nimport { clientEvent } from \"../framework/clientEvent\";\nimport { poolManager } from \"../framework/poolManager\";\nimport { audioManager } from \"../framework/audioManager\";\nimport { constant } from \"../framework/constant\";\nconst { ccclass, property } = _decorator;\n\n@ccclass(\"effectManager\")\nexport class effectManager extends Component {\n    /* class member could be defined like this */\n    // dummy = '';\n\n    @property({type: Prefab})\n    pfTailLine: Prefab = null!;\n\n    @property({type: carManager})\n    carManager: carManager = null!;\n    currentNode: Node | null = null;\n\n    start () {\n        // Your initialization goes here.\n    }\n\n    onEnable () {\n        clientEvent.on('startBraking', this.onBrakingStart, this);\n        clientEvent.on('endBraking', this.onBrakingEnd, this);\n    }\n\n    onDisable () {\n        clientEvent.off('startBraking', this.onBrakingStart, this);\n        clientEvent.off('endBraking', this.onBrakingEnd, this);\n    }\n\n    onBrakingStart() {\n\n        this.currentNode = poolManager.instance.getNode(this.pfTailLine, this.node);\n        this.currentNode.setWorldPosition(this.carManager.mainCar.node.worldPosition);\n        this.currentNode.eulerAngles = this.carManager.mainCar.node.eulerAngles;\n\n        audioManager.instance.playSound(constant.AUDIO_SOUND.STOP);\n    }\n\n    onBrakingEnd () {\n\n        let node = this.currentNode;\n        this.currentNode = null;\n        this.scheduleOnce(()=>{\n            if (node && node.isValid) {\n                poolManager.instance.putNode(node);\n            }\n        }, 2);\n    }\n\n    update (deltaTime: number) {\n\n        // Your update function goes here.\n        if (this.currentNode && this.carManager.mainCar) {\n            this.currentNode.setWorldPosition(this.carManager.mainCar.node.worldPosition);\n            this.currentNode.eulerAngles = this.carManager.mainCar.node.eulerAngles;\n        }\n    }\n\n    reset () {\n        if (this.currentNode) {\n\n            poolManager.instance.putNode(this.currentNode);\n            poolManager.instance.clearPool(this.currentNode.name);\n            this.currentNode = null;\n\n            //原有的都释放掉\n            let arr = this.node.children.slice(0);\n            for (let idx = 0; idx < arr.length; idx++) {\n                let node = arr[idx];\n                if (node && node.isValid) {\n                    node.destroy();\n                }\n            }\n        }\n    }\n}\n"]}