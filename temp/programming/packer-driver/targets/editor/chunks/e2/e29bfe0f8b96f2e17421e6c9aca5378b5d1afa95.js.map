{"version":3,"sources":["file:///Users/xiejiapei/Documents/3D%20Game/Car/assets/script/ui/fight/clickBox.ts"],"names":["_decorator","Component","ProgressBarComponent","Node","Label","Sprite","fightConstants","gameLogic","uiManager","constant","ccclass","property","clickBox","scheduleTime","curProgress","clickTimes","curClick","isOpenBox","rewardValue","start","show","Math","floor","random","nodeClickBtn","active","progress","node","nodeBox","nodeReward","nodeMenu","updateRewardIcon","SHARE_FUNCTION","CLICK_BOX","spIcon","onBtnBoxClick","showReward","lbReward","string","CLICK_BOX_REWARD","update","deltaTime","onBtnNormalClick","addGold","close","onBtnDoubleClick","openReward","err","instance","hideDialog"],"mappings":"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","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\n\nimport { _decorator, Component, ProgressBarComponent, Node, Label, Sprite } from \"cc\";\nimport { fightConstants } from \"../../fight/fightConstants\";\nimport { playerData } from \"../../framework/playerData\";\nimport { gameLogic } from \"../../logic/gameLogic\";\nimport { uiManager } from \"../../framework/uiManager\";\nimport { constant } from \"../../framework/constant\";\nconst { ccclass, property } = _decorator;\n\n@ccclass(\"clickBox\")\nexport class clickBox extends Component {\n    /* class member could be defined like this */\n    // dummy = '';\n\n    @property(ProgressBarComponent)\n    progress: ProgressBarComponent = null!;\n\n    @property(Node)\n    nodeReward: Node = null!;\n\n    @property(Label)\n    lbReward: Label = null!;\n\n    @property(Node)\n    nodeBox: Node = null!;\n\n    @property(Node)\n    nodeMenu: Node = null!;\n\n    @property(Node)\n    nodeClickBtn: Node = null!;\n\n    @property(Sprite)\n    spIcon: Sprite = null!;\n\n    scheduleTime: number = 0;\n    curProgress: number = 50;\n    clickTimes: number = 15;\n    curClick: number = 0;\n    isOpenBox: boolean = false;\n    rewardValue = 0;\n\n    start () {\n        // Your initialization goes here.\n    }\n\n    show () {\n        this.scheduleTime = 0;\n        this.curProgress = 50;\n        this.clickTimes = 10 + Math.floor(Math.random() * 5); //10-15次随机次数\n        this.curClick = 0;\n        this.isOpenBox = false;\n\n        this.nodeClickBtn.active = true;\n        this.progress.node.active = true;\n        this.nodeBox.active = true;\n        this.nodeReward.active = false;\n        this.nodeMenu.active = false;\n\n        gameLogic.updateRewardIcon(constant.SHARE_FUNCTION.CLICK_BOX, this.spIcon);\n    }\n\n    onBtnBoxClick () {\n        if (this.isOpenBox) {\n            return;\n        }\n\n        this.curClick++;\n\n        if (this.curClick > this.clickTimes) {\n            //TODO 打开宝箱\n            this.isOpenBox = true;\n\n            //切换展示\n            this.showReward();\n        } else {\n            this.curProgress += 20;\n\n            this.curProgress = this.curProgress > 100 ?  100 : this.curProgress;\n        }\n    }\n\n    showReward () {\n        this.nodeClickBtn.active = false;\n        this.progress.node.active = false;\n        this.nodeBox.active = false;\n        this.nodeReward.active = true;\n        this.nodeMenu.active = true;\n\n        this.lbReward.string = `+${fightConstants.CLICK_BOX_REWARD}`;\n\n\n        this.rewardValue = fightConstants.CLICK_BOX_REWARD;\n        //TODO 展示一倍或者三倍奖励\n        // playerData.instance.updatePlayerInfo('gold', fightConstants.CLICK_BOX_REWARD);\n    }\n\n    update (deltaTime: number) {\n        this.scheduleTime += deltaTime;\n        if (this.scheduleTime >= 0.1) {\n            //100ms减3%\n            this.curProgress -= 3;\n            this.curProgress = this.curProgress < 0 ? 0 : this.curProgress;\n            this.scheduleTime = 0;\n        }\n\n        this.progress.progress = this.curProgress / 100;\n    }\n\n    onBtnNormalClick () {\n        gameLogic.addGold(fightConstants.CLICK_BOX_REWARD);\n\n        this.close();\n    }\n\n    onBtnDoubleClick () {\n        gameLogic.openReward(constant.SHARE_FUNCTION.CLICK_BOX, (err)=>{\n            if (!err) {\n                gameLogic.addGold(fightConstants.CLICK_BOX_REWARD*2);\n\n                this.close();\n            }\n        });\n\n\n    }\n\n    close () {\n        uiManager.instance.hideDialog('fight/clickBox');\n    }\n\n}\n"]}