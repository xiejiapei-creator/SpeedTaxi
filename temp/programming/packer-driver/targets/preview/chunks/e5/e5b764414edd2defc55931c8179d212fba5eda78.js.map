{"version":3,"sources":["file:///Users/xiejiapei/NewProject_1/assets/script/ui/fight/fightCanvas.ts"],"names":["_decorator","Component","SpriteFrame","Node","carManager","gameLogic","loading","clientEvent","ccclass","property","fightCanvas","curProgress","isFirstLoad","isTouching","start","imgAd","imgVideo","imgShare","loadingUI","show","node","on","EventType","TOUCH_START","onTouchStart","TOUCH_END","onTouchEnd","TOUCH_CANCEL","onEnable","updateLoadingProgress","showGuide","onDisable","off","tip","active","controlMainCar","isShow","scheduleOnce","progress","tips","Math","floor","updateProgress","loadNewLevel","finishLoading"],"mappings":"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","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\n\nimport { _decorator, Component, SpriteFrame, Node } from \"cc\";\nimport { carManager } from \"../../fight/carManager\";\nimport { gameLogic } from \"../../logic/gameLogic\";\nimport { loading } from \"../common/loading\";\nimport { clientEvent } from \"../../framework/clientEvent\";\nconst { ccclass, property } = _decorator;\n\n@ccclass(\"fightCanvas\")\nexport class fightCanvas extends Component {\n    /* class member could be defined like this */\n    // dummy = '';\n\n    @property(carManager)\n    carManager: carManager = null!;\n\n    @property(SpriteFrame)\n    imgShare: SpriteFrame = null!;\n\n    @property(SpriteFrame)\n    imgVideo: SpriteFrame = null!;\n\n    @property(loading)\n    loadingUI: loading = null!;\n\n    @property(Node)\n    tip: Node = null;\n\n    curProgress: number = 50;\n    isFirstLoad: boolean = true; //首次加载\n    isTouching: boolean = false; //是否正在点击中\n\n    start () {\n        gameLogic.imgAd = this.imgVideo;\n        gameLogic.imgShare = this.imgShare;\n\n        //首次进来，起始50%（前面为登录加载）\n        this.loadingUI.show(this.curProgress);\n\n        // Your initialization goes here.\n        this.node.on(Node.EventType.TOUCH_START, this.onTouchStart, this);\n        this.node.on(Node.EventType.TOUCH_END, this.onTouchEnd, this);\n        this.node.on(Node.EventType.TOUCH_CANCEL, this.onTouchEnd, this);\n    }\n\n    onEnable () {\n        clientEvent.on('updateLoading', this.updateLoadingProgress, this);\n        clientEvent.on('showGuide', this.showGuide, this);\n    }\n\n    onDisable () {\n        clientEvent.off('updateLoading', this.updateLoadingProgress, this);\n        clientEvent.off('showGuide', this.showGuide, this);\n    }\n\n    onTouchStart () {\n        this.isTouching = true;\n        this.tip.active = false;\n        this.carManager.controlMainCar(true);\n    }\n\n    onTouchEnd () {\n        this.isTouching = false;\n        this.carManager.controlMainCar(false);\n    }\n\n    showGuide (isShow: boolean) {\n        if (isShow && this.isTouching) {\n            //异步执行，使引导正常，因为\n            this.scheduleOnce(()=>{\n                this.onTouchStart();\n            }, 0);\n        }\n    }\n\n    updateLoadingProgress (progress: number, tips: string) {\n        if (!this.isFirstLoad) {\n            this.curProgress += progress;\n        } else {\n            this.curProgress += Math.floor(progress / 2);  //首次加载是跟登录一块的，这样起始是50%\n        }\n\n\n        this.loadingUI.updateProgress(this.curProgress, tips);\n    }\n\n    loadNewLevel () {\n        this.loadingUI.node.active = true;\n        this.curProgress = 0;\n        this.isFirstLoad = false;\n    }\n\n    finishLoading () {\n        this.loadingUI.node.active = false;\n    }\n\n    // update (deltaTime: number) {\n    //     // Your update function goes here.\n    // }\n}\n"]}