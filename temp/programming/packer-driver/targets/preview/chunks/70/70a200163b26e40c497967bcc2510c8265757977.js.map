{"version":3,"sources":["file:///Users/xiejiapei/Documents/Car/assets/script/ui/fight/balance.ts"],"names":["_decorator","Component","Node","SpriteFrame","Sprite","Label","Widget","playerData","util","clientEvent","uiManager","audioManager","constant","gameLogic","i18n","ccclass","property","balance","type","displayName","rewardMoney","isFinishLevel","showBalanceTimes","start","show","level","curProgress","isTakeOver","maxProgress","money","end","len","progress","length","idx","active","getComponent","spriteFrame","imgProgressFinished","imgProgressNoActive","imgProgressActive","lbCurLevel","string","toString","lbTargetLevel","spStart","imgLevelFinished","spEnd","imgLevelUnfinished","take","lbTakeCount","t","value","lbGetNormal","formatMoney","lbGetMulti","instance","playSound","AUDIO_SOUND","WIN","updateRewardIcon","SHARE_FUNCTION","BALANCE","spIcon","percent","Math","floor","random","nodeDouble","onBtnGetNormalClick","rewardOver","onBtnGetMultiClick","openReward","err","finishBuyTask","BUY_CAR_TYPE","PASS_LEVEL","playerInfo","passLevel","updatePlayerInfo","showFlyReward","REWARD_TYPE","GOLD","dispatchEvent","hideDialog","isComeFromBalance"],"mappings":"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","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\n\nimport { _decorator, Component, Node, SpriteFrame, Sprite, Label, Widget } from \"cc\";\nimport { playerData } from \"../../framework/playerData\";\nimport { util } from \"../../framework/util\";\nimport { clientEvent } from \"../../framework/clientEvent\";\nimport { uiManager } from \"../../framework/uiManager\";\nimport { audioManager } from \"../../framework/audioManager\";\nimport { constant } from \"../../framework/constant\";\nimport { gameLogic } from \"../../logic/gameLogic\";\nimport { i18n } from \"../../i18nMaster/runtime-scripts/LanguageData\";\nconst { ccclass, property } = _decorator;\n\n@ccclass(\"balance\")\nexport class balance extends Component {\n    /* class member could be defined like this */\n    // dummy = '';\n    @property(Sprite)\n    spStart: Sprite = null!;\n\n    @property(Sprite)\n    spEnd: Sprite = null!;\n\n    @property({type: Label})\n    lbCurLevel: Label = null!;\n\n    @property({type: Label})\n    lbTargetLevel: Label = null!;\n\n    @property(Widget)\n    wgMenu: Widget = null!;\n\n    @property({type: Node, displayName: \"进度项\"})\n    public progress:Node[] = [];\n\n    @property(SpriteFrame)\n    imgLevelFinished: SpriteFrame = null!;\n\n    @property(SpriteFrame)\n    imgLevelUnfinished: SpriteFrame = null!;\n\n    @property(SpriteFrame)\n    imgProgressNoActive: SpriteFrame = null!;\n\n    @property(SpriteFrame)\n    imgProgressActive: SpriteFrame = null!;\n\n    @property(SpriteFrame)\n    imgProgressFinished: SpriteFrame = null!;\n\n    @property(Label)\n    lbTakeCount: Label = null!;\n\n    @property(Label)\n    lbGetNormal: Label = null!;\n\n    @property(Label)\n    lbGetMulti: Label = null!;\n\n    @property(Sprite)\n    spIcon: Sprite = null!;\n\n    @property(Node)\n    nodeDouble: Node = null!;\n\n    rewardMoney: number = 0;\n    isFinishLevel: boolean = false;\n    showBalanceTimes: number = 0;\n\n    start () {\n        // Your initialization goes here.\n\n    }\n\n    show (level: number, curProgress: number, isTakeOver: boolean,  maxProgress: number, money: number, isFinishLevel:boolean) {\n\n        this.showBalanceTimes ++;\n        //设置顶部关卡进度\n        let start = curProgress;\n        let end = isTakeOver ? start : start - 1;\n\n        const len = this.progress.length;\n        for (let idx = 0; idx < maxProgress; idx++) {\n            if(maxProgress > len){\n                break;\n            }\n\n            this.progress[idx].active = true;\n            if (idx < end) {\n                this.progress[idx].getComponent(Sprite)!.spriteFrame = this.imgProgressFinished;\n            } else {\n                this.progress[idx].getComponent(Sprite)!.spriteFrame = this.imgProgressNoActive;\n            }\n        }\n\n        if (!isTakeOver) {\n            this.progress[end].getComponent(Sprite)!.spriteFrame = this.imgProgressActive;\n        }\n\n        for (let idx = maxProgress; idx < this.progress.length; idx++) {\n            this.progress[idx].active = false;\n        }\n\n        this.lbCurLevel.string = level.toString();\n        this.lbTargetLevel.string = `${level + 1}`;\n\n        this.isFinishLevel = isFinishLevel;\n        this.spStart.spriteFrame = this.imgLevelFinished;\n        if (isFinishLevel) {\n            this.spEnd.spriteFrame = this.imgLevelFinished;\n        } else {\n            this.spEnd.spriteFrame = this.imgLevelUnfinished;\n        }\n\n        //设置完成了几个订单\n        let take = end >= 0 ? end : 0;\n        this.lbTakeCount.string = i18n.t(\"balance.你完成了%{value}个订单\", { value: take});\n\n        //设置奖励多少\n\n        this.rewardMoney = money;\n        this.lbGetNormal.string = util.formatMoney(money);\n        this.lbGetMulti.string = util.formatMoney(money * 3);\n\n        if (isFinishLevel) {\n            audioManager.instance.playSound(constant.AUDIO_SOUND.WIN);\n        }\n\n        gameLogic.updateRewardIcon(constant.SHARE_FUNCTION.BALANCE, this.spIcon);\n\n        //有30%的概率不显示该按钮\n        let percent = Math.floor(Math.random() * 100);\n\n        //触发显示\n        this.nodeDouble.active = percent < 30;\n    }\n\n    onBtnGetNormalClick () {\n        //普通领取\n        this.rewardOver(this.rewardMoney);\n    }\n\n    onBtnGetMultiClick () {\n        //3倍领取\n        gameLogic.openReward(constant.SHARE_FUNCTION.BALANCE, (err)=>{\n            if (!err) {\n                this.rewardOver(this.rewardMoney * 3);\n            }\n        });\n    }\n\n    rewardOver (rewardMoney: number) {\n        //如果关卡是完成的，进入下一关\n        //如果关卡是未完成的，还是保留同一关\n\n        if (this.isFinishLevel) {\n            //关卡完成了，进入下一关\n            gameLogic.finishBuyTask(constant.BUY_CAR_TYPE.PASS_LEVEL, playerData.instance.playerInfo.level, false);\n            playerData.instance.passLevel(rewardMoney);\n        } else {\n            playerData.instance.updatePlayerInfo('gold', rewardMoney);\n        }\n\n        if (rewardMoney > 0) {\n            gameLogic.showFlyReward(constant.REWARD_TYPE.GOLD, ()=>{\n                clientEvent.dispatchEvent('updateGold');\n            });\n        }\n\n        uiManager.instance.hideDialog('fight/balance');\n\n        if (playerData.instance.playerInfo.level > 0) {\n            playerData.instance.isComeFromBalance = false;\n            clientEvent.dispatchEvent('newLevel', this.isFinishLevel);\n        } else {\n            playerData.instance.isComeFromBalance = false;\n            clientEvent.dispatchEvent('newLevel', this.isFinishLevel);\n        }\n    }\n}\n"]}