{"version":3,"sources":["file:///Users/xiejiapei/SpeedTaxi/assets/script/framework/localConfig.ts"],"names":["_decorator","resourceUtil","csvManager","ccclass","property","localConfig","arrCars","_callback","_skills","currentLoad","cntLoad","servers","instance","_instance","loadConfig","cb","loadCSV","arrTables","length","forEach","tableName","index","array","getData","err","content","addTable","tryToCallbackOnFinished","getJsonData","queryOne","key","value","queryByID","ID","getTable","getTableArr","getCars","arr","sort","elementA","elementB","queryAll","queryIn","values","queryByCondition","condition","getCurrentServer","getVersion","server","version"],"mappings":"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","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\n\nimport { _decorator, Component } from \"cc\";\nimport { resourceUtil } from \"./resourceUtil\";\nimport { csvManager } from \"./csvManager\";\nimport { ICarInfo } from \"./constant\";\nconst { ccclass, property } = _decorator;\n\n@ccclass(\"localConfig\")\nexport class localConfig {\n    /* class member could be defined like this */\n    static _instance: localConfig;\n    csvManager: csvManager | null = null;\n    arrCars: ICarInfo[] = [];\n\n    static get instance () {\n        if (this._instance) {\n            return this._instance;\n        }\n\n        this._instance = new localConfig();\n        return this._instance;\n    }\n\n    _callback: Function | null = null;\n    _skills: any = {};\n    currentLoad = 0;\n    cntLoad = 0;\n    servers: any = [];\n\n    loadConfig (cb: Function) {\n        this._callback = cb;\n        this.csvManager = new csvManager();\n        this.loadCSV();\n    }\n\n    loadCSV () {\n        //新增数据表 请往该数组中添加....\n        var arrTables = ['talk', 'car', 'signIn'];\n        this.cntLoad = arrTables.length + 1; //+1主要是后续还有技能配置的加载，特殊处理\n\n        //客户端加载\n        arrTables.forEach((tableName, index, array)=> {\n            resourceUtil.getData(tableName, (err, content) => {\n                this.csvManager!.addTable(tableName, content);\n                this.tryToCallbackOnFinished();\n            });\n        });\n\n        //载入技能配置信息\n        // resourceUtil.getData(\"skills\", function (err, content) {\n        //     _this._skills = JSON.parse(content);\n        //     _this.tryToCallbackOnFinished();\n        // });\n\n        resourceUtil.getJsonData(\"servers\", (err, content)=> {\n            this.servers = content;\n            this.tryToCallbackOnFinished();\n        });\n    }\n\n    queryOne (tableName: string, key: string, value: any) {\n        return this.csvManager!.queryOne(tableName, key, value);\n    }\n\n    queryByID (tableName: string, ID: string) {\n        return this.csvManager!.queryByID(tableName, ID);\n    }\n\n    getTable (tableName: string) {\n        return this.csvManager!.getTable(tableName);\n    }\n\n    getTableArr (tableName: string) {\n        return this.csvManager!.getTableArr(tableName);\n    }\n\n    getCars () {\n        if (this.arrCars.length > 0) {\n            return this.arrCars;\n        }\n\n        let arr = localConfig.instance.getTableArr('car') as any[];\n        this.arrCars = arr.sort((elementA, elementB)=>{\n            return elementA.sort - elementB.sort\n        });\n\n        return this.arrCars;\n    }\n\n    // 选出指定表里面所有有 key=>value 键值对的数据\n    queryAll (tableName: string, key: string, value: any) {\n        return this.csvManager!.queryAll(tableName, key, value);\n    }\n\n    // 选出指定表里所有 key 的值在 values 数组中的数据，返回 Object，key 为 ID\n    queryIn (tableName: string, key: string, values: Array<any>) {\n        return this.csvManager!.queryIn(tableName, key, values);\n    }\n\n    // 选出符合条件的数据。condition key 为表格的key，value 为值的数组。返回的object，key 为数据在表格的ID，value为具体数据\n    queryByCondition (tableName: string, condition: any) {\n        return this.csvManager!.queryByCondition(tableName, condition);\n    }\n\n    tryToCallbackOnFinished () {\n        if (this._callback) {\n            this.currentLoad++;\n            if (this.currentLoad >= this.cntLoad) {\n                this._callback();\n            }\n        }\n    }\n\n    getCurrentServer () {\n        return this.servers[0];\n    }\n\n    getVersion () {\n        let server = this.getCurrentServer();\n        let version = server ? server.version : 'unknown';\n        return version;\n    }\n    // update (deltaTime: number) {\n    //     // Your update function goes here.\n    // }\n}\n"]}