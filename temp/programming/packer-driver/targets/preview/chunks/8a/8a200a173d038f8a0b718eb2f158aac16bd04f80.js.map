{"version":3,"sources":["file:///Users/xiejiapei/NewProject_1/assets/script/framework/playerData.ts"],"names":["_decorator","Component","configuration","constant","util","localConfig","ccclass","property","playerData","serverTime","localTime","showCar","isComeFromBalance","userId","playerInfo","history","settings","isNewBee","dataVersion","signInInfo","instance","_instance","loadGlobalCache","getUserId","loadFromCache","loadDataByKey","LOCAL_CACHE","PLAYER","currentCar","INITIAL_CAR","HISTORY","SETTINGS","keyName","ret","str","getConfigData","JSON","parse","e","createPlayerInfo","loginData","level","gold","realLevel","passCheckPoint","createDate","Date","cars","push","dictBuyTask","dictGetCarTime","key","savePlayerInfoToLocalCache","saveAccount","setUserId","setConfigData","stringify","saveAll","setConfigDataWithoutSave","DATA_VERSION","updatePlayerInfo","value","isChanged","hasOwnProperty","updateSignInCurrentDay","Object","keys","length","isNeedRecycleSignInInfo","createNewSignInInfo","offectDays","getDeltaDays","signInDate","now","updateSignInFillSignInDays","currentDay","MAX_SIGNIN_DAY","receivedDays","afterFillSignInDays","isNeedRecycled","diffTime","updateSignInReceivedDays","day","Array","isArray","includes","Number","isClear","getSignInReceivedInfo","isAllReceived","isTodayReceived","isHadCarAndDuringPeriod","ID","getCarDate","isHadCar","indexOf","updateDictGetCarTime","getLastOnlineRewardTime","onlineRewardTime","getCurrentTime","updateLastOnlineRewardTime","elapsedTime","time","syncServerTime","hasCar","carID","hasCarCanReceived","arrCars","getCars","idx","carInfo","type","BUY_CAR_TYPE","GOLD","SIGNIN","num","finishBuyTask","isAdd","getBuyTypeProgress","getCurrentCar","useCar","carId","buyCar","clear","passLevel","rewardMoney","console","log","MAX_LEVEL","getRandLevel","randLevel","Math","floor","random"],"mappings":"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","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\n\nimport { _decorator, Component } from \"cc\";\nimport { configuration } from \"./configuration\";\nimport { constant } from \"./constant\";\nimport { util } from \"./util\";\nimport { localConfig } from '../framework/localConfig';\n\nconst { ccclass, property } = _decorator;\n\n// {\n//     level: number,\n//     gold: number,\n//     diamond: number,\n//     realLevel: number,\n//     passCheckPoint: boolean,\n//     createDate: any,\n//     currentCar: number,\n//     cars: number[],\n//     onlineRewardTime: number,\n//     dictBuyTask: { [name: string]: any },\n//     signInInfo: { [name: string]: any },\n//     dictGetCarTime: { [name: string]: any }\n// };\n\ntype UserInfoForNumber = 'level' | 'gold' | 'diamond' | 'realLevel' | 'currentCar' | 'onlineRewardTime';\n\n@ccclass(\"playerData\")\nexport class playerData extends Component {\n    /* class member could be defined like this */\n    // dummy = '';\n\n    static _instance: playerData;\n    serverTime = 0;\n    localTime = 0;\n    showCar = 0;\n    isComeFromBalance: boolean = false;\n\n    static get instance() {\n        if (this._instance) {\n            return this._instance;\n        }\n\n        this._instance = new playerData();\n        return this._instance;\n    }\n\n    userId: string = '';\n    playerInfo: { [name: string]: any} = {};\n    history: any = null;\n    settings: any = null;\n    isNewBee: boolean = false;    //默认非新手\n    dataVersion: string = '';\n    // bag: any = null;\n    signInInfo: any = null;\n\n    loadGlobalCache() {\n        let userId = configuration.instance.getUserId();\n        if (userId) {\n            this.userId = userId;\n        }\n    }\n\n    loadFromCache() {\n        //读取玩家基础数据\n        this.playerInfo = this.loadDataByKey(constant.LOCAL_CACHE.PLAYER);\n\n        if (this.playerInfo.currentCar) {\n            this.showCar = this.playerInfo.currentCar;\n        } else {\n            this.showCar = constant.INITIAL_CAR;\n        }\n\n        this.history = this.loadDataByKey(constant.LOCAL_CACHE.HISTORY);\n\n        // this.bag = this.loadDataByKey(constants.LOCAL_CACHE.BAG);\n\n        this.settings = this.loadDataByKey(constant.LOCAL_CACHE.SETTINGS);\n    }\n\n    loadDataByKey(keyName: string) {\n        let ret = {};\n        let str = configuration.instance.getConfigData(keyName);\n        if (str) {\n            try {\n                ret = JSON.parse(str);\n            } catch (e) {\n                ret = {};\n            }\n        }\n\n        return ret;\n    }\n\n    createPlayerInfo(loginData?: { [name: string]: any }) {\n        this.playerInfo.level = 1;  //默认初始关卡\n        this.playerInfo.gold = 0;\n        this.playerInfo.realLevel = 1;//真正关卡\n        this.playerInfo.passCheckPoint = false;//是否已经通过20关\n        this.playerInfo.createDate = new Date(); //记录创建时间\n        this.playerInfo.currentCar = constant.INITIAL_CAR; //初始车辆\n        this.playerInfo.cars = [];\n        this.playerInfo.cars.push(constant.INITIAL_CAR); //拥有的车辆\n        this.playerInfo.dictBuyTask = {};\n        this.showCar = this.playerInfo.currentCar;\n        this.isNewBee = true; //区分新老玩家\n\n        this.playerInfo.signInInfo = {};//七日签到\n        this.playerInfo.dictGetCarTime = {}//获得车辆的时间\n\n\n        if (loginData) {\n            for (let key in loginData) {\n                this.playerInfo[key] = loginData[key];\n            }\n        }\n\n        // if (!this.playerInfo.avatarUrl) {\n        //     //随机个头像给他\n        // }\n\n        // this.playerInfo.dictTask = this.createRandTask();\n        // this.playerInfo.taskDate = new Date(); //任务创建时间\n        this.savePlayerInfoToLocalCache();\n    }\n\n    saveAccount(userId: any) {\n        this.userId = userId;\n        configuration.instance.setUserId(userId);\n    }\n\n    /**\n     * 保存玩家数据\n     */\n    savePlayerInfoToLocalCache() {\n        configuration.instance.setConfigData(constant.LOCAL_CACHE.PLAYER, JSON.stringify(this.playerInfo));\n    }\n\n    /**\n     * 当数据同步完毕，即被覆盖的情况下，需要将数据写入到本地缓存，以免数据丢失\n     */\n    saveAll() {\n        configuration.instance.setConfigDataWithoutSave(constant.LOCAL_CACHE.PLAYER, JSON.stringify(this.playerInfo));\n        configuration.instance.setConfigDataWithoutSave(constant.LOCAL_CACHE.HISTORY, JSON.stringify(this.history));\n        configuration.instance.setConfigDataWithoutSave(constant.LOCAL_CACHE.SETTINGS, JSON.stringify(this.settings));\n        // configuration.instance.setConfigDataWithoutSave(constant.LOCAL_CACHE.BAG, JSON.stringify(this.bag));\n        configuration.instance.setConfigData(constant.LOCAL_CACHE.DATA_VERSION, this.dataVersion);\n    }\n\n    /**\n     * 更新用户信息\n     * 例如钻石，金币，道具\n     * @param {String} key\n     * @param {Number} value\n     */\n    updatePlayerInfo(key: string, value: any) {\n        let isChanged = false;\n        if (this.playerInfo.hasOwnProperty(key)) {\n            if (typeof value === 'number') {\n                isChanged = true;\n                this.playerInfo[key] += value;\n                if (this.playerInfo[key] < 0) {\n                    this.playerInfo[key] = 0;\n                }\n                //return;\n            } else if (typeof value === 'boolean' || typeof value === 'string') {\n                isChanged = true;\n                this.playerInfo[key] = value;\n            }\n        } else if(key === 'gold'){\n            // 容错处理，仅更新特定数据 gold。谨防用户数据在未知情况下丢失而无法存储到本地\n            isChanged = true;\n            this.playerInfo[key] = value;\n        }\n        if (isChanged) {\n            //有修改就保存到localcache\n            configuration.instance.setConfigData(constant.LOCAL_CACHE.PLAYER, JSON.stringify(this.playerInfo));\n        }\n    }\n\n    /*********************** 七日签到 ***********************/\n    /**\n     * 更新签到领取日期，补签状态，如果超过7天则轮回\n     */\n    updateSignInCurrentDay() {\n        if (Object.keys(this.playerInfo.signInInfo).length === 0 || this.isNeedRecycleSignInInfo()) {\n            this.createNewSignInInfo();\n        } else {\n            let offectDays = util.getDeltaDays(this.playerInfo.signInInfo.signInDate, Date.now());//比较两个时间，为0则今天更新过\n            if (offectDays === 0) {\n                return;\n            }\n\n            //将昨天“补签后”但是没领取奖励重置为“补签”状态\n            this.updateSignInFillSignInDays(0, true);\n\n            //更新领取今日签到信息\n            this.playerInfo.signInInfo.currentDay += offectDays;\n            //当测试时间差异的时候将当前的时间设置为第一天\n            if (this.playerInfo.signInInfo.currentDay <= 0) {\n                this.createNewSignInInfo();\n            }\n            this.playerInfo.signInInfo.currentDay > constant.MAX_SIGNIN_DAY ? constant.MAX_SIGNIN_DAY : this.playerInfo.signInInfo.currentDay;\n            this.playerInfo.signInInfo.signInDate = Date.now();\n        }\n        this.savePlayerInfoToLocalCache();\n    }\n\n    /**\n     * 创建新的签到信息\n     */\n    createNewSignInInfo() {\n        if (!this.playerInfo.hasOwnProperty('signInInfo')) {\n            this.playerInfo.signInInfo = {};\n            this.playerInfo.dictGetCarTime = {};\n        }\n\n        let signInInfo = this.playerInfo.signInInfo;\n        //创建时间\n        signInInfo.createDate = Date.now();\n        //签到时间\n        signInInfo.signInDate = Date.now();\n        //当前天数\n        signInInfo.currentDay = 1;\n        //已经领取天数\n        signInInfo.receivedDays = [];\n        //补签后可以领取的天数\n        signInInfo.afterFillSignInDays = [];\n        this.savePlayerInfoToLocalCache();\n    }\n\n    /**\n    * 是否需要重新开始一个新的签到周期\n    */\n    isNeedRecycleSignInInfo(): boolean {\n        if (!this.playerInfo.signInInfo) {\n            this.createNewSignInInfo();\n        }\n        let isNeedRecycled = false;\n        let diffTime = util.getDeltaDays(this.playerInfo.signInInfo.createDate, Date.now());\n        //当前日期与创建日期超过七天，1号7号相差6天，第8天进行更新\n        if (diffTime >= constant.MAX_SIGNIN_DAY) {\n            isNeedRecycled = true;\n        }\n        return isNeedRecycled;\n    }\n\n    /**\n     * 更新领取奖励后已领取日期数组\n     * @param {Number} day\n    */\n    updateSignInReceivedDays(day: number) {\n        let receivedDays = this.playerInfo.signInInfo.receivedDays;\n        if (Array.isArray(receivedDays) && receivedDays.includes(day)) {\n            return;\n        }\n        receivedDays.push(Number(day));\n        this.savePlayerInfoToLocalCache();\n    }\n\n    /**\n     * 更新补签后变为可领取的日期数组\n     * @param {number} day\n     * @param {boolean} isClear 是否清空昨天补签完后还未领取的数组\n     */\n    updateSignInFillSignInDays(day: number, isClear: boolean) {\n        let afterFillSignInDays = this.playerInfo.signInInfo.afterFillSignInDays;\n\n        if (!isClear) {\n            if (Array.isArray(afterFillSignInDays) && afterFillSignInDays.includes(day)) {\n                return;\n            }\n            afterFillSignInDays.push(Number(day));\n        } else {\n            afterFillSignInDays.length = 0;\n        }\n        this.savePlayerInfoToLocalCache();\n    }\n\n    /**\n     * 返回“当天”还有“全部”的签到奖励领取情况\n     * 用来判断“显示领取按钮”，“登陆自动显示签到界面”和“红点提示”\n     * @returns {boolean, boolean} isAllReceived是否全部领取， isTodayReceived是否当天已领取\n     */\n    getSignInReceivedInfo(): any {\n        if (!this.playerInfo.signInInfo) {\n            this.createNewSignInInfo();\n        }\n        let signInInfo = this.playerInfo.signInInfo;\n        let isAllReceived = false;\n        let isTodayReceived = false;\n        if (signInInfo.receivedDays.length < signInInfo.currentDay) {\n            isAllReceived = false;\n        } else {\n            isAllReceived = true;\n        }\n\n        if (signInInfo.receivedDays.includes(signInInfo.currentDay)) {\n            isTodayReceived = true;\n        } else {\n            isTodayReceived = false;\n        }\n\n        return { isAllReceived, isTodayReceived };\n    }\n\n\n    /**\n     * 判断如果已有该车,且还在第一次得到车的周期内则显示“车，领取, 暂不领取”，否则为“金币，双倍领取，普通领取”\n     *\n     * @param {number} ID 车的ID\n     * @returns\n     * @memberof playerData\n     */\n    isHadCarAndDuringPeriod(ID: number) {\n        let createDate = this.playerInfo.signInInfo.createDate;\n        if (!this.playerInfo.dictGetCarTime) {\n            this.playerInfo.dictGetCarTime = {};\n        }\n        let getCarDate = this.playerInfo.dictGetCarTime[ID];\n        let isHadCar = this.playerInfo.cars.indexOf(ID) !== -1;\n\n        return isHadCar && getCarDate && getCarDate < createDate;\n    }\n\n    /**\n     * 更新汽车的领取信息\n     * @param ID 车的ID\n     */\n    updateDictGetCarTime(ID: number) {\n        if (!this.playerInfo.dictGetCarTime) {\n            this.playerInfo.dictGetCarTime = {};\n        }\n        this.playerInfo.dictGetCarTime[ID] = this.playerInfo.signInInfo.createDate;\n        configuration.instance.setConfigData(constant.LOCAL_CACHE.PLAYER, JSON.stringify(this.playerInfo));\n    }\n\n    /**********************************************/\n\n    getLastOnlineRewardTime() {\n        if (this.playerInfo.onlineRewardTime) {\n            return this.playerInfo.onlineRewardTime;\n        }\n\n        this.playerInfo.onlineRewardTime = this.getCurrentTime();\n\n        this.savePlayerInfoToLocalCache();\n\n        return this.playerInfo.onlineRewardTime;\n    }\n\n    /**\n     * 更新最后一次领取时间\n     *\n     * @param {number} elapsedTime 已经度过的时间,单位秒\n     * @memberof playerData\n     */\n    updateLastOnlineRewardTime(elapsedTime: number) {\n        let time = this.getCurrentTime() - elapsedTime * 1000;\n\n        this.playerInfo.onlineRewardTime = time;\n        this.savePlayerInfoToLocalCache();\n    }\n\n    /**\n     * 同步服务器时间\n     */\n    syncServerTime(serverTime: number) {\n        this.serverTime = serverTime;\n        this.localTime = Date.now();\n    }\n\n    /**\n     * 获取当前时间\n     */\n    getCurrentTime() {\n        let diffTime = Date.now() - this.localTime;\n\n        return this.serverTime + diffTime;\n    }\n\n    /**\n     * 检查玩家是否拥有对应车辆\n     *\n     * @param {number} carID\n     * @memberof playerData\n     */\n    hasCar(carID: number) {\n        if (carID === constant.INITIAL_CAR) {\n            return true;\n        }\n\n        if (!this.playerInfo.cars) {\n            this.playerInfo.cars = [constant.INITIAL_CAR];\n        }\n\n        return this.playerInfo.cars.indexOf(carID) !== -1;\n    }\n\n    hasCarCanReceived() {\n        let arrCars = localConfig.instance.getCars();\n        for (let idx = 0; idx < arrCars.length; idx++) {\n            let carInfo = arrCars[idx];\n\n            if (carInfo.type === constant.BUY_CAR_TYPE.GOLD || carInfo.type === constant.BUY_CAR_TYPE.SIGNIN) {\n                continue;\n            }\n\n            if (this.hasCar(carInfo.ID)) {\n                continue;\n            }\n\n            if (!this.playerInfo.dictBuyTask || !this.playerInfo.dictBuyTask.hasOwnProperty(carInfo.type)) {\n                continue;\n            }\n\n            if (this.playerInfo.dictBuyTask[carInfo.type] >= carInfo.num) {\n                return true;\n            }\n        }\n\n        return false;\n    }\n\n    finishBuyTask(type: number, value: number, isAdd?: Boolean) {\n        if (!this.playerInfo.dictBuyTask) {\n            this.playerInfo.dictBuyTask = {};\n        }\n\n        if (!this.playerInfo.dictBuyTask.hasOwnProperty(type) || !isAdd) {\n            this.playerInfo.dictBuyTask[type] = value;\n        } else {\n            this.playerInfo.dictBuyTask[type] += value;\n        }\n\n        this.savePlayerInfoToLocalCache();\n    }\n\n    /**\n     * 获取任务的进度\n     *\n     * @param {*} type\n     * @memberof playerData\n     */\n    getBuyTypeProgress(type: number) {\n        if (this.playerInfo.dictBuyTask && this.playerInfo.dictBuyTask.hasOwnProperty(type)) {\n            return this.playerInfo.dictBuyTask[type];\n        }\n\n        return 0;\n    }\n\n    /**\n     * 获取当前车辆\n     *\n     * @returns\n     * @memberof playerData\n     */\n    getCurrentCar() {\n        if (!this.playerInfo.currentCar) {\n            this.playerInfo.currentCar = constant.INITIAL_CAR;\n        }\n\n        return this.playerInfo.currentCar;\n    }\n\n    /**\n     *\n     * 使用某辆车\n     * @param {*} carId\n     * @returns\n     * @memberof playerData\n     */\n    useCar(carId: number) {\n        if (!this.hasCar(carId)) {\n            return false;\n        }\n\n        this.playerInfo.currentCar = carId;\n        this.savePlayerInfoToLocalCache();\n\n        this.showCar = this.playerInfo.currentCar;\n\n        return true;\n    }\n\n    buyCar(carId: number) {\n        if (this.playerInfo.cars.indexOf(carId) !== -1) {\n            return true;\n        }\n\n        this.playerInfo.cars.push(carId);\n        this.savePlayerInfoToLocalCache();\n\n        return true;\n    }\n\n    clear() {\n        this.playerInfo = {};\n        this.settings = {};\n        this.saveAll();\n    }\n\n    /*********************** 战斗相关 ***********************/\n    //关卡完成\n    passLevel(rewardMoney: number) {\n        this.playerInfo.level++;\n        this.playerInfo.gold += rewardMoney;\n\n        console.log(\"###1 this.playerInfo.level\", this.playerInfo.level, 'this.playerInfo.realLevel', this.playerInfo.realLevel);\n\n        //标记已经通过20关了\n        if (!this.playerInfo.passCheckPoint) {\n            if (this.playerInfo.level >= constant.MAX_LEVEL) {\n                this.playerInfo.realLevel = constant.MAX_LEVEL;\n                this.playerInfo.level = constant.MAX_LEVEL;\n\n                this.playerInfo.passCheckPoint = true;\n                console.log(\"###2 this.playerInfo.level\", this.playerInfo.level, 'this.playerInfo.realLevel', this.playerInfo.realLevel);\n            } else {\n                this.playerInfo.realLevel = this.playerInfo.level;\n            }\n        } else {\n            this.playerInfo.realLevel = this.getRandLevel();\n            console.log(\"###3 this.playerInfo.level\", this.playerInfo.level, 'this.playerInfo.realLevel', this.playerInfo.realLevel);\n        }\n\n        this.savePlayerInfoToLocalCache();\n    }\n\n    getRandLevel() {\n        //随机16-20关中的一个,但不跟现在的一样\n        let level = -1;\n\n        while(level === -1){\n            let randLevel = 16 + Math.floor(Math.random() * 5);\n            if (randLevel !== this.playerInfo.realLevel) {\n                level = randLevel;\n            }\n        }\n\n        return level\n    }\n}\n"]}