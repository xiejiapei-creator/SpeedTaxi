{"version":3,"sources":["file:///Users/xiejiapei/NewProject_1/assets/script/ui/signIn/signInItem.ts"],"names":["_decorator","Component","Sprite","SpriteFrame","Label","Node","Animation","playerData","constant","gameLogic","localConfig","clientEvent","uiManager","resourceUtil","ccclass","property","signInItem","_parent","itemInfo","isHadCar","start","init","parent","lbValue","string","rewardType","REWARD_TYPE","CAR","String","amount","lbDayIndex","ID","setIcon","setStatus","status","node","getComponent","spriteFrame","Number","sfBgBlue","sfYellow","type","DIAMOND","GOLD","spReward","sfGold","targetCar","instance","queryByID","carModel","model","isHadCarAndDuringPeriod","GOLD_REWARD","SECOND","SEVENT","setCarIcon","SIGNIN_REWARD_STATUS","RECEIVED","showItemUI","RECEIVABLE","UNRECEIVABLE","FILL_SIGNIN","AFTER_FILL_SIGNIN","isShowLight","isShowTick","isShowBtnFillSignIn","isShowBtnReceive","nodeLight","active","lightAni","play","stop","nodeTick","nodeBtnFillSign","nodeBtnAfterFillSign","onBtnAfterFillSignClick","receiveReward","markReceived","bind","updateDictGetCarTime","updateSignInReceivedDays","dispatchEvent","close","shiftFromPopupSeq","receiveStatus","getSignInReceivedInfo","isAllReceived","pushToPopupSeq","markAfterFillSignIn","updateSignInFillSignInDays","onBtnFillSignInClick","openReward","SHARE_FUNCTION","err"],"mappings":"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","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\n\nimport { _decorator, Component, Sprite, SpriteFrame, Label, Node, Vec3, Animation} from \"cc\";\nimport { playerData } from '../../framework/playerData';\nimport { constant } from '../../framework/constant';\nimport { gameLogic } from \"../../logic/gameLogic\";\nimport { localConfig } from '../../framework/localConfig';\nimport { clientEvent } from '../../framework/clientEvent';\nimport { uiManager } from '../../framework/uiManager';\nimport { resourceUtil } from '../../framework/resourceUtil';\n\nconst { ccclass, property } = _decorator;\n\n\n@ccclass(\"signInItem\")\nexport class signInItem extends Component {\n    /* class member could be defined like this */\n    // dummy = '';\n\n    /* use `property` decorator if your want the member to be serializable */\n    // @property\n    // serializableDummy = 0;\n\n    //蓝色背景\n    @property(SpriteFrame)\n    sfBgBlue: SpriteFrame = null!;\n\n    //黄色背景\n    @property(SpriteFrame)\n    sfYellow: SpriteFrame = null!;\n\n    //奖励节点\n    @property(Sprite)\n    spReward: Sprite = null!;\n\n    //金币图标\n    @property(SpriteFrame)\n    sfGold: SpriteFrame = null!;\n\n    //打勾图标\n    @property(Node)\n    nodeTick: Node = null!;\n\n    //补签按钮\n    @property(Node)\n    nodeBtnFillSign: Node = null!;\n\n    //补签后可以领取的按钮\n    @property(Node)\n    nodeBtnAfterFillSign: Node = null!;\n\n    //天数标记\n    @property(Label)\n    lbDayIndex: Label = null!;\n\n    //高亮节点\n    @property(Node)\n    nodeLight: Node = null!;\n\n    //奖励数量\n    @property(Label)\n    lbValue: Label = null!;\n\n    _parent: any = null;\n    itemInfo: any = null;\n    isHadCar: any = null;\n\n    start () {\n        // Your initialization goes here.\n    }\n\n    init (itemInfo: any, parent: any) {\n        this._parent = parent;\n        this.itemInfo = itemInfo;\n        this.lbValue.string = itemInfo.rewardType === constant.REWARD_TYPE.CAR ? '' : String(itemInfo.amount);\n        this.lbDayIndex.string = String(itemInfo.ID);\n\n        this.setIcon(itemInfo.rewardType);\n        this.setStatus(itemInfo.status);\n\n        this.node.getComponent(Sprite)!.spriteFrame = Number(itemInfo.ID) >= 7 ? this.sfBgBlue : this.sfYellow;\n    }\n\n\n    setIcon (type: number) {\n\n        switch (type) {\n            case constant.REWARD_TYPE.DIAMOND:\n                break;\n            case constant.REWARD_TYPE.GOLD:\n                this.spReward.spriteFrame = this.sfGold;\n                break;\n            case constant.REWARD_TYPE.CAR:\n                let targetCar = localConfig.instance.queryByID('car', this.itemInfo.amount);\n                let carModel = targetCar.model;\n                if (playerData.instance.isHadCarAndDuringPeriod(this.itemInfo.amount)) {\n                    this.spReward.spriteFrame = this.sfGold;\n                    if (this.itemInfo.ID == 2) {\n                        this.lbValue.string = String(constant.GOLD_REWARD.SECOND);\n                    } else if (this.itemInfo.ID == 7) {\n                        this.lbValue.string = String(constant.GOLD_REWARD.SEVENT);\n                    }\n                } else {\n                    resourceUtil.setCarIcon(carModel, this.spReward, false, ()=>{});\n                }\n                break;\n        }\n    }\n\n    setStatus (status: number) {\n        switch (status) {\n            case constant.SIGNIN_REWARD_STATUS.RECEIVED:\n                this.showItemUI(false, true, false, false);\n                break;\n            case constant.SIGNIN_REWARD_STATUS.RECEIVABLE:\n                this.showItemUI(true, false, false, false);\n                break;\n            case constant.SIGNIN_REWARD_STATUS.UNRECEIVABLE:\n                this.showItemUI(false, false, false, false);\n                break;\n            case constant.SIGNIN_REWARD_STATUS.FILL_SIGNIN:\n                this.showItemUI(false, false, true, false);\n                break;\n            case constant.SIGNIN_REWARD_STATUS.AFTER_FILL_SIGNIN:\n                this.showItemUI(true, false, false, true);\n                break;\n        }\n    }\n\n    showItemUI (isShowLight: boolean, isShowTick: boolean, isShowBtnFillSignIn: boolean, isShowBtnReceive: boolean) {\n        this.nodeLight.active = isShowLight;\n        let lightAni = this.nodeLight.getComponent(Animation)!;\n        isShowLight ? lightAni.play() : lightAni.stop();\n        this.nodeTick.active = isShowTick;\n        this.nodeBtnFillSign.active = isShowBtnFillSignIn;\n        this.nodeBtnAfterFillSign.active = isShowBtnReceive;\n    }\n\n    /**\n     * 点击补签后的领取按钮触发，或者点击当前可领取触发\n     */\n    onBtnAfterFillSignClick () {\n        if (this.itemInfo.status === constant.SIGNIN_REWARD_STATUS.AFTER_FILL_SIGNIN || this.itemInfo.status === constant.SIGNIN_REWARD_STATUS.RECEIVABLE) {\n            this._parent.receiveReward(this.itemInfo, false, this.markReceived.bind(this));\n        }\n    }\n\n    /**\n     * 标记为已领取\n     */\n    markReceived () {\n        this.itemInfo.status = constant.SIGNIN_REWARD_STATUS.RECEIVED;\n        this.setStatus(this.itemInfo.status);\n\n        //记录车领取的时间\n        if ((this.itemInfo.ID === 2 || this.itemInfo.ID === 7) && !this.isHadCar) {\n            playerData.instance.updateDictGetCarTime(this.itemInfo.amount);\n        }\n\n        //添加已领取奖励的天数\n        if (this.itemInfo.ID) {\n            playerData.instance.updateSignInReceivedDays(this.itemInfo.ID);\n            clientEvent.dispatchEvent('updateSignIn');\n        }\n\n        this.close();\n    }\n\n    close () {\n        uiManager.instance.shiftFromPopupSeq('common/showReward');\n        let receiveStatus = playerData.instance.getSignInReceivedInfo();\n        let isAllReceived = receiveStatus.isAllReceived;\n        if (!isAllReceived) {\n            uiManager.instance.pushToPopupSeq('signIn/signIn', 'signIn', {});\n        } else {\n            uiManager.instance.shiftFromPopupSeq(\"common/showReward\");\n        }\n    }\n\n    /**\n     * 标记为补签后可以领取\n     */\n    markAfterFillSignIn() {\n        this.itemInfo.status = constant.SIGNIN_REWARD_STATUS.AFTER_FILL_SIGNIN;\n        this.setStatus(this.itemInfo.status);\n        playerData.instance.updateSignInFillSignInDays(this.itemInfo.ID, false);\n    }\n\n    /**\n     * 补签按钮\n     */\n    onBtnFillSignInClick () {\n        gameLogic.openReward(constant.SHARE_FUNCTION.FILL_SIGNIN, (err)=>{\n            if (!err) {\n                this.markAfterFillSignIn();\n            }\n        })\n    }\n\n}\n"]}