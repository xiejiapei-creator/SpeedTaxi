{"version":3,"sources":["file:///Users/xiejiapei/SpeedTaxi/assets/script/ui/main/flyReward.ts"],"names":["_decorator","Component","Node","Animation","SpriteFrame","find","Vec3","clientEvent","flyRewardItem","ccclass","property","MAX_REWARD_COUNT","flyReward","finishIdx","_callback","undefined","isGoldOrDiamond","start","aniBoom","play","createReward","getTargetPos","nodeGold","node","destroy","ZERO","position","imgReward","imgGold","targetPos","idx","rewardNode","flyItem","addComponent","parent","ndRewardParent","layer","show","onFlyOver","setInfo","dispatchEvent","active","setEndListener","callback"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Animation, SpriteFrame, find, Vec3 } from \"cc\";\nimport { clientEvent } from \"../../framework/clientEvent\";\nimport { flyRewardItem } from \"./flyRewardItem\";\nconst { ccclass, property } = _decorator;\n\nconst MAX_REWARD_COUNT = 10;\n\n@ccclass(\"flyReward\")\nexport class flyReward extends Component {\n    /* class member could be defined like this */\n    // dummy = '';\n\n    /* use `property` decorator if your want the member to be serializable */\n    // @property\n    // serializableDummy = 0;\n\n    @property(SpriteFrame)\n    imgGold: SpriteFrame = null!;\n\n    @property(Node)\n    ndRewardParent: Node = null!;\n\n    @property(Animation)\n    aniBoom: Animation = null!;\n\n    finishIdx: number = 0;\n    _callback: Function | undefined = undefined;\n    isGoldOrDiamond: boolean = true;\n\n\n    start () {\n        // Your initialization goes here.\n        this.aniBoom.play();\n\n        this.createReward();\n    }\n\n    getTargetPos () {\n        let nodeGold = find('Canvas/goldPos') as Node;\n\n        if (!nodeGold) {\n            this.node.destroy();\n\n            if (this._callback) {\n                this._callback();\n            }\n\n            return Vec3.ZERO;\n        }\n\n\n        return nodeGold.position;\n    }\n\n    createReward () {\n        let imgReward = this.imgGold;\n        // if (!this.isGoldOrDiamond) {\n        //     imgReward = this.imgDiamond;\n        // }\n\n        let targetPos = this.getTargetPos();\n        for (var idx = 0; idx < MAX_REWARD_COUNT; idx++) {\n            let rewardNode = new Node('flyRewardItem');\n            let flyItem = rewardNode.addComponent(flyRewardItem);\n            rewardNode.parent = this.ndRewardParent;\n            rewardNode.layer = this.ndRewardParent.layer;\n            flyItem.show(imgReward, targetPos, (node: Node)=>{\n                this.onFlyOver(node);\n            })\n        }\n    }\n\n    setInfo (isGoldOrDiamond: boolean) {\n        this.isGoldOrDiamond = isGoldOrDiamond;\n    }\n\n    onFlyOver (node: Node) {\n        if (this.isGoldOrDiamond) {\n            clientEvent.dispatchEvent('receiveGold');\n        } else {\n            clientEvent.dispatchEvent('receiveDiamond');\n        }\n\n        // cc.gameSpace.audioManager.playSound('sell', false);\n        node.active = false;\n        this.finishIdx++;\n        if (this.finishIdx === MAX_REWARD_COUNT) {\n            if (this._callback) {\n                this._callback();\n            }\n\n            this.node.destroy();\n        }\n    }\n\n    /**\n     * 设置播放回调\n     * @param {Function} callback\n     * @param {Object} target\n     */\n    setEndListener (callback?: Function) {\n        this._callback = callback;\n    }\n\n}\n"]}