{"version":3,"sources":["file:///Users/xiejiapei/Documents/3D%20Game/Car/assets/script/ui/shop/shop.ts"],"names":["_decorator","Component","Label","Button","Node","Prefab","Vec3","Color","Sprite","instantiate","playerData","clientEvent","util","uiManager","shopPage","poolManager","localConfig","resourceUtil","constant","gameLogic","i18n","ccclass","property","MAX_PAGE_SIZE","shop","currentPage","currentCar","carDegree","rotateSpeed","currentCarInfo","pageIndex","maxPage","currentCarID","start","onEnable","on","updateGold","onShopItemSelect","updateButtons","onDisable","off","show","cars","instance","getCars","Math","floor","length","showPage","pfPage","parent","nodePages","refreshPageLabel","getComponent","setPage","gold","playerInfo","lbGold","string","formatMoney","onBtnCloseClick","hideDialog","getCar","buyCar","ID","rewardInfo","rewardType","REWARD_TYPE","CAR","amount","showDialog","useCar","refreshUse","onBtnGetClick","carID","hasCar","dispatchEvent","type","BUY_CAR_TYPE","GOLD","num","showTips","addGold","currentProgress","getBuyTypeProgress","GAME","LOGIN","CONTINUOUS_LOGIN","PASS_LEVEL","SIGNIN","SHARE","openReward","SHARE_FUNCTION","SHOP_SHARE","err","VIDEO","SHOP_VIDEO","isOver","checkBtn","onBtnGoldClick","showFlyReward","curPage","unSelectAll","unUseAll","putNode","queryByID","toString","spCarBlack","node","active","getUICar","model","prefab","console","error","getNode","nodeCarParent","setCarIcon","update","deltaTime","eulerAngles","lbDesc","nodeGo","nodeBuy","lbGo","nodeGet","interactable","lbPrice","color","WHITE","RED","strDesc","t","lbPage","onBtnLeftClick","shopPageScript","onBtnRightClick"],"mappings":"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","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\n\nimport { _decorator, Component, Label, Button, Node, Prefab, Vec3, Color, Sprite, instantiate } from \"cc\";\nimport { playerData } from \"../../framework/playerData\";\nimport { clientEvent } from \"../../framework/clientEvent\";\nimport { util } from \"../../framework/util\";\nimport { uiManager } from \"../../framework/uiManager\";\nimport { shopPage } from \"./shopPage\";\nimport { poolManager } from \"../../framework/poolManager\";\nimport { localConfig } from \"../../framework/localConfig\";\nimport { resourceUtil } from \"../../framework/resourceUtil\";\nimport { constant } from \"../../framework/constant\";\nimport { gameLogic } from \"../../logic/gameLogic\";\nimport { i18n } from \"../../i18nMaster/runtime-scripts/LanguageData\";\n\nconst { ccclass, property } = _decorator;\n\nconst MAX_PAGE_SIZE = 9;    //一页最多9个\n\n@ccclass(\"shop\")\nexport class shop extends Component {\n    /* class member could be defined like this */\n    // dummy = '';\n\n    /* use `property` decorator if your want the member to be serializable */\n    // @property\n    // serializableDummy = 0;\n\n    @property(Label)\n    lbGold: Label = null!;\n\n    @property(Node)\n    nodeGet: Node = null!;\n\n    @property(Node)\n    nodeGold: Node = null!;\n\n    @property(Node)\n    nodeBuy: Node = null!;\n\n    @property(Node)\n    nodeGo: Node = null!;\n\n    @property(Label)\n    lbDesc: Label = null!;\n\n    @property(Label)\n    lbPrice: Label = null!;\n\n    @property(Label)\n    lbGo: Label = null!;\n\n    @property(Node)\n    nodeCarParent: Node = null!;\n\n    @property(Node)\n    nodePages: Node = null!;\n\n    @property(Prefab)\n    pfPage: Prefab = null!;\n\n    @property(Sprite)\n    spCarBlack: Sprite = null!;\n\n    @property(Label)\n    lbPage: Label = null!;\n\n    //TODO 由于3D编辑器目前还不支持pageView控件，所以现在只有单页\n    currentPage: Node | null = null;\n    currentCar: Node | null = null;\n    carDegree = 0;\n    rotateSpeed = 30;\n    currentCarInfo: any;\n    pageIndex = 0;\n    maxPage = 0;\n    currentCarID = 0;\n\n    start () {\n        // Your initialization goes here.\n    }\n\n    onEnable () {\n        clientEvent.on('updateGold', this.updateGold, this);\n        clientEvent.on('onShopItemSelect', this.onShopItemSelect, this);\n        clientEvent.on('updateBuyTask', this.updateButtons, this);\n    }\n\n    onDisable () {\n        clientEvent.off('updateGold', this.updateGold, this);\n        clientEvent.off('onShopItemSelect', this.onShopItemSelect, this);\n        clientEvent.off('updateBuyTask', this.updateButtons, this);\n    }\n\n    show () {\n        let cars = localConfig.instance.getCars();\n        this.maxPage = Math.floor(cars.length / MAX_PAGE_SIZE);\n\n        this.updateGold();\n\n        this.showPage();\n    }\n\n    showPage () {\n        if (!this.currentPage) {\n            this.currentPage = instantiate(this.pfPage);\n            this.currentPage.parent = this.nodePages;\n            this.pageIndex = 0;\n            this.refreshPageLabel();\n            this.currentPage.getComponent(shopPage)!.setPage(this.pageIndex);\n        }\n\n        this.currentPage.getComponent(shopPage)!.show();\n    }\n\n    updateGold () {\n        let gold = playerData.instance.playerInfo.gold || 0;\n        this.lbGold.string = util.formatMoney(gold);\n    }\n\n    onBtnCloseClick () {\n        uiManager.instance.hideDialog('shop/shop');\n    }\n\n    getCar () {\n        // playerData.instance.buyCar(this.currentCarInfo.ID);\n        gameLogic.buyCar(this.currentCarInfo.ID);\n\n        let rewardInfo = {\n            rewardType: constant.REWARD_TYPE.CAR,\n            amount: 1,\n            ID: this.currentCarInfo.ID\n        };\n        uiManager.instance.showDialog('common/showReward', [rewardInfo, false, /*i18n.t(\"showReward.buySuccessful\")*/'购买成功', ()=>{\n            //启用\n            gameLogic.useCar(this.currentCarInfo.ID);\n\n            this.currentPage!.getComponent(shopPage)!.refreshUse(this.currentCarInfo.ID);\n        }, null, /*i18n.t(\"showReward.confirm\")*/'确认']);\n    }\n\n    onBtnGetClick () {\n        let carID = this.currentCarInfo.ID;\n        if (playerData.instance.hasCar(carID)) {\n            // 点击换车按钮后才算换车成功\n            playerData.instance.useCar(carID);\n            clientEvent.dispatchEvent('updateCar');\n            // return;\n        } else if (this.currentCarInfo.type === constant.BUY_CAR_TYPE.GOLD) {\n            if (this.currentCarInfo.num > playerData.instance.playerInfo.gold) {\n                //金币不足\n                // return;\n\n                uiManager.instance.showTips(/*i18n.t(\"shop.getGold\")*/'获取金币', ()=>{});\n                return;\n            }\n\n            //扣款\n            gameLogic.addGold(-this.currentCarInfo.num);\n\n            //获得车\n            this.getCar();\n        } else {\n            let currentProgress = playerData.instance.getBuyTypeProgress(this.currentCarInfo.type);\n\n            if (currentProgress >= this.currentCarInfo.num) {\n                //可以获得了\n                this.getCar();\n            } else {\n                //对应任务，对应界面\n                switch (this.currentCarInfo.type) {\n                    case constant.BUY_CAR_TYPE.GAME:\n                    case constant.BUY_CAR_TYPE.LOGIN:\n                    case constant.BUY_CAR_TYPE.CONTINUOUS_LOGIN:\n                    case constant.BUY_CAR_TYPE.PASS_LEVEL:\n                        this.onBtnCloseClick();\n                        break;\n                    case constant.BUY_CAR_TYPE.SIGNIN:\n                        this.onBtnCloseClick();\n                        //显示签到界面\n                        uiManager.instance.showDialog('signIn/signIn');\n                        break;\n                    case constant.BUY_CAR_TYPE.SHARE:\n                        gameLogic.openReward(constant.SHARE_FUNCTION.SHOP_SHARE, (err, type)=>{\n\n                        });\n                        break;\n                    case constant.BUY_CAR_TYPE.VIDEO:\n                        gameLogic.openReward(constant.SHARE_FUNCTION.SHOP_VIDEO, (err, isOver)=>{\n\n                        });\n                        break;\n                }\n            }\n        }\n    }\n\n    checkBtn () {\n\n    }\n\n    onBtnGoldClick () {\n        gameLogic.openReward(constant.SHARE_FUNCTION.SHOP_VIDEO, (err)=>{\n            if (!err) {\n                gameLogic.showFlyReward(constant.REWARD_TYPE.GOLD, ()=>{\n                    gameLogic.addGold(300);\n                    this.updateButtons();\n                });\n            }\n        });\n    }\n\n    onShopItemSelect (carID: number, useCar: boolean) {\n        let curPage = this.currentPage!.getComponent(shopPage)!;\n        curPage.unSelectAll();\n\n        if (useCar) {\n            curPage.unUseAll();\n        }\n\n        if (this.currentCar) {\n            poolManager.instance.putNode(this.currentCar);\n            this.currentCar = null;\n        }\n\n        //刷新界面展示\n        this.currentCarInfo = localConfig.instance.queryByID('car', carID.toString());\n\n        if (this.currentCarInfo.type === constant.BUY_CAR_TYPE.SHARE) {\n            //分享审核的时候特殊处理\n            this.currentCarInfo.type = constant.BUY_CAR_TYPE.GOLD;\n            this.currentCarInfo.num = 2000;\n        }\n\n        if (playerData.instance.hasCar(carID)) {\n            this.spCarBlack.node.active = false;\n            resourceUtil.getUICar(this.currentCarInfo.model, (err, prefab)=>{\n                if (err) {\n                    console.error(err, this.currentCarInfo.model);\n                    return;\n                }\n\n                this.carDegree = 0;\n                this.currentCar = poolManager.instance.getNode(prefab, this.nodeCarParent);\n            });\n        } else {\n            this.spCarBlack.node.active = true;\n            resourceUtil.setCarIcon(this.currentCarInfo.model, this.spCarBlack, true, ()=>{\n\n            });\n        }\n\n        this.updateButtons();\n    }\n\n    update (deltaTime: number) {\n        // Your update function goes here.\n        //旋转展示车辆\n        if (this.currentCar) {\n            this.carDegree -= deltaTime * this.rotateSpeed;\n\n            if (this.carDegree <= -360) {\n                this.carDegree += 360;\n            }\n\n            this.currentCar.eulerAngles = new Vec3(0, this.carDegree, 0);\n        }\n    }\n\n    updateButtons () {\n        if (playerData.instance.hasCar(this.currentCarInfo.ID)) {\n            //已拥有该车辆\n            this.lbDesc.string = '';\n            this.nodeGo.active = true;\n            this.nodeBuy.active = false;\n\n            this.lbGo.string = /*i18n.t('shop.acquired')*/'换车';\n\n            //TODO 引擎点击事件传递有问题，先开起来\n            this.nodeGet.getComponent(Button)!.interactable = true;\n\n            //即刻玩那边特殊处理，如果是分享则变成用金币获取\n        } else if (this.currentCarInfo.type === constant.BUY_CAR_TYPE.GOLD) {\n\n            this.lbDesc.string = '';\n            this.lbPrice.string = this.currentCarInfo.num;\n\n            if (playerData.instance.playerInfo.gold >= this.currentCarInfo.num) {\n                this.lbPrice.color = Color.WHITE;\n                this.nodeGet.getComponent(Button)!.interactable = true;\n                // this.nodeGold.active = false;\n\n            } else {\n                this.lbPrice.color = Color.RED;\n                this.nodeGet.getComponent(Button)!.interactable = true;\n\n                // this.nodeGold.active = true;\n            }\n\n            this.nodeGo.active = false;\n            this.nodeBuy.active = true;\n\n        } else {\n            this.nodeGet.getComponent(Button)!.interactable = true;\n            this.nodeGo.active = true;\n            this.nodeBuy.active = false;\n\n            let num = playerData.instance.getBuyTypeProgress(this.currentCarInfo.type);\n\n            if (num < this.currentCarInfo.num) {\n                this.lbGo.string = /*i18n.t('shop.go')*/'前往商店';\n            } else {\n                this.lbGo.string = /*i18n.t('shop.receive')*/'获取';\n            }\n\n            let strDesc = i18n.t(`carTask.${this.currentCarInfo.show}`);\n            if (this.currentCarInfo.type !== constant.BUY_CAR_TYPE.SIGNIN) {\n                strDesc += `(${i18n.t(\"shop.current\")}：${num}/${this.currentCarInfo.num})`;\n            }\n\n            this.lbDesc.string = strDesc;\n        }\n    }\n\n    refreshPageLabel () {\n        this.lbPage.string = `${(this.pageIndex + 1)}/${this.maxPage + 1}`;\n    }\n\n    onBtnLeftClick () {\n        const shopPageScript = this.currentPage!.getComponent(shopPage)!;\n        if (this.pageIndex > 0) {\n            this.pageIndex-- ;\n        } else {\n            this.pageIndex = this.maxPage;\n        }\n\n        this.refreshPageLabel();\n        shopPageScript.setPage(this.pageIndex);\n        shopPageScript.show();\n    }\n\n    onBtnRightClick () {\n        const shopPageScript = this.currentPage!.getComponent(shopPage)!;\n        if (this.pageIndex >= this.maxPage) {\n            this.pageIndex = 0;\n        } else {\n            this.pageIndex++ ;\n        }\n\n        this.refreshPageLabel();\n        shopPageScript.setPage(this.pageIndex);\n        shopPageScript.show();\n    }\n}\n"]}