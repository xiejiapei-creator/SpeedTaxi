{"version":3,"sources":["file:///Users/xiejiapei/SpeedTaxi/assets/script/ui/shop/shopItem.ts"],"names":["_decorator","Component","Node","Sprite","resourceUtil","poolManager","clientEvent","playerData","ccclass","property","shopItem","currentCar","carInfo","ID","type","num","model","start","onEnable","on","refreshCarIcon","updateBuyTask","onDisable","off","setCarIcon","spCarIcon","instance","hasCar","curProgress","getBuyTypeProgress","nodeRedDot","active","show","select","nodeUsed","putNode","node","getCurrentCar","scheduleOnce","onItemClick","value","nodeSelect","used","isShowIntertitial","dispatchEvent","updateUseState"],"mappings":"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","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\n\nimport { _decorator, Component, Node, Sprite } from \"cc\";\nimport { resourceUtil } from \"../../framework/resourceUtil\";\nimport { poolManager } from \"../../framework/poolManager\";\nimport { clientEvent } from \"../../framework/clientEvent\";\nimport { playerData } from \"../../framework/playerData\";\nimport { ICarInfo } from \"../../framework/constant\";\nconst { ccclass, property } = _decorator;\n@ccclass(\"shopItem\")\nexport class shopItem extends Component {\n    @property (Node)\n    nodeSelect: Node = null!;\n\n    @property (Node)\n    nodeUsed: Node = null!;\n\n    @property (Node)\n    nodeRedDot: Node = null!;\n\n    @property (Sprite)\n    spCarIcon: Sprite = null!;\n\n    currentCar: Node | null = null!;\n    carInfo: ICarInfo = { ID: 0, type: 0, num: 0, model: '' };\n\n    start () {\n        // Your initialization goes here.\n    }\n\n    onEnable() {\n        clientEvent.on('buyCar', this.refreshCarIcon, this);\n        clientEvent.on('updateBuyTask', this.updateBuyTask, this);\n    }\n\n    onDisable() {\n        clientEvent.off('buyCar', this.refreshCarIcon, this);\n        clientEvent.off('updateBuyTask', this.updateBuyTask, this);\n    }\n\n    refreshCarIcon() {\n        if (!this.carInfo) {\n            return;\n        }\n\n        resourceUtil.setCarIcon(this.carInfo.model, this.spCarIcon, !playerData.instance.hasCar(this.carInfo.ID), ()=>{\n\n        });\n\n        this.updateBuyTask();\n    }\n\n    updateBuyTask () {\n        if (!playerData.instance.hasCar(this.carInfo.ID)) {\n            let curProgress = playerData.instance.getBuyTypeProgress(this.carInfo.type);\n            this.nodeRedDot.active = curProgress >= this.carInfo.num;\n        } else {\n            this.nodeRedDot.active = false;\n        }\n    }\n\n    show (carInfo: ICarInfo) {\n        this.carInfo = carInfo;\n        this.select = false;\n        this.nodeUsed.active = false;\n        if (this.currentCar) {\n            poolManager.instance.putNode(this.currentCar);\n            this.currentCar = null;\n        }\n\n        if (!carInfo) {\n            //空目录\n            this.spCarIcon.node.active = false;\n            return;\n        }\n\n        this.spCarIcon.node.active = true;\n\n\n        this.refreshCarIcon();\n\n        if (this.carInfo.ID === playerData.instance.getCurrentCar()) {\n            this.scheduleOnce(()=>{\n                //选中一下\n                this.onItemClick(false);\n            }, 0);\n        }\n\n    }\n\n    set select (value: boolean) {\n        this.nodeSelect.active = value;\n    }\n\n    get select () {\n        return this.nodeSelect.active;\n    }\n\n    set used (value: boolean) {\n        this.nodeUsed.active = value;\n    }\n\n    get used () {\n        return this.nodeUsed.active;\n    }\n\n    onItemClick (isShowIntertitial = true) {\n        if (!this.carInfo) {\n            return;\n        }\n\n\n        let hasCar = playerData.instance.hasCar(this.carInfo.ID);\n\n        clientEvent.dispatchEvent('onShopItemSelect', this.carInfo.ID, hasCar);\n\n        this.select = true;\n\n        if (hasCar) {\n            this.used = true;\n\n            // 改成点击换车按钮才换车\n            // playerData.instance.useCar(this.carInfo.ID);\n            // clientEvent.dispatchEvent('updateCar');\n        }\n    }\n\n    updateUseState () {\n        this.used = this.carInfo.ID === playerData.instance.getCurrentCar();\n    }\n\n    // update (deltaTime: number) {\n    //     // Your update function goes here.\n    // }\n}\n"]}